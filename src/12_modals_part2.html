<div id="editTimeModal" class="modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width: 85%; max-width: 320px; padding: 0; border-radius: 20px; z-index: 10001; overflow: hidden; background: #fff;">
    <div style="background: linear-gradient(135deg, #e6f7ff 0%, #ffffff 100%); padding: 24px 20px 10px 20px; text-align: center;">
        <div style="font-size: 32px; margin-bottom: 8px;">⏳</div>
        <h3 style="margin: 0; font-size: 18px; color: #333; font-weight: 600;">记录制作耗时</h3>
        <p style="margin: 4px 0 0 0; font-size: 13px; color: #666;">记录下你的心血与时间</p>
    </div>
    
    <div style="padding: 20px;">
        <input type="hidden" id="editTimePlanId">
        
        <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 24px;">
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                <div style="position: relative; width: 100%;">
                    <input type="number" id="editTimeHours" min="0" placeholder="0" step="1" oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        style="width: 100%; padding: 12px; padding-right: 30px; background: #f9fafb; border: 2px solid #f0f0f0; border-radius: 12px; font-size: 20px; outline: none; box-sizing: border-box; transition: all 0.2s; text-align: center; font-weight: bold; color: #333;"
                        onfocus="this.style.background='white'; this.style.borderColor='var(--primary)';"
                        onblur="this.style.background='#f9fafb'; this.style.borderColor='#f0f0f0';"
                    >
                    <span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 12px; pointer-events: none;">小时</span>
                </div>
            </div>
            <div style="font-weight: bold; color: #ccc;">:</div>
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                <div style="position: relative; width: 100%;">
                    <input type="number" id="editTimeMinutes" min="0" max="59" placeholder="0" step="1" oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                        style="width: 100%; padding: 12px; padding-right: 30px; background: #f9fafb; border: 2px solid #f0f0f0; border-radius: 12px; font-size: 20px; outline: none; box-sizing: border-box; transition: all 0.2s; text-align: center; font-weight: bold; color: #333;"
                        onfocus="this.style.background='white'; this.style.borderColor='var(--primary)';"
                        onblur="this.style.background='#f9fafb'; this.style.borderColor='#f0f0f0';"
                    >
                    <span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 12px; pointer-events: none;">分钟</span>
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 12px;">
            <button onclick="closeAllModals()" style="flex: 1; padding: 12px; border: 1px solid #eee; background: white; color: #666; border-radius: 12px; font-size: 15px; font-weight: 500;">取消</button>
            <button onclick="savePlanTime()" style="flex: 1; padding: 12px; border: none; background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; border-radius: 12px; font-size: 15px; font-weight: bold; box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);">保存</button>
        </div>
    </div>
</div>

<!-- Tag Management Modal -->
<div id="tagManageModal" class="modal" style="width: 85%; max-width: 320px; padding: 24px; border-radius: 16px;">
    <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 20px; text-align: center; color: #333;">管理标签</h3>
    
    <div class="tag-input-container">
        <div id="currentTagsList" style="display:flex; flex-wrap:wrap; gap:5px; width:100%;"></div>
        <input type="text" id="newTagInput" placeholder="输入标签按回车添加" style="flex:1; min-width:80px; border:none; outline:none; font-size:13px; background:transparent; padding:4px 0;" onkeypress="if(event.key === 'Enter') addNewTag()">
    </div>

    <div style="margin-top: 15px; border-top: 1px dashed #eee; padding-top: 10px;">
        <div style="font-size: 12px; color: #999; margin-bottom: 8px;">历史标签</div>
        <div id="tagHistoryList" style="display: flex; flex-wrap: wrap; gap: 6px; max-height: 100px; overflow-y: auto;">
            <!-- History tags injected here -->
        </div>
    </div>

    <div class="modal-btn-group">
        <button class="m-btn m-btn-primary" onclick="finishTagEditing()">完成</button>
    </div>
</div>

<!-- Storage Usage Modal -->
<div id="storageModal" class="modal" style="width: 85%; max-width: 340px; padding: 20px; border-radius: 16px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0; font-size: 18px; font-weight: bold; color: #333;">存储占用与清理</h3>
        <div onclick="closeAllModals()" style="padding: 5px; cursor: pointer; color: #999;">✕</div>
    </div>
    
    <div id="storageUsageSummary" style="margin-bottom: 20px;">
        <!-- Content injected by JS -->
    </div>
    
    <div style="display: flex; flex-direction: column; gap: 10px;">
        <button class="m-btn" style="background: #fffbe6; color: #faad14; border: 1px solid #ffe58f;" onclick="clearCompletedPlanThumbnails()">
            🧹 清理已完成计划缩略图
        </button>
        <button class="m-btn" style="background: #fff1f0; color: #ff4d4f; border: 1px solid #ffa39e;" onclick="if(confirm('确定要清理所有缩略图吗？这将移除所有计划列表中的预览图，但不影响计划本身。')) clearAllPlanThumbnails()">
            🗑️ 清理所有缩略图
        </button>
        <button class="m-btn m-btn-primary" onclick="closeAllModals()" style="margin-top: 5px;">关闭</button>
    </div>
</div>